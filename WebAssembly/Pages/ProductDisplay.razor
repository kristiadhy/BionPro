@page "/products"
@using static WebAssembly.Shared.Enum.GlobalEnum

<PageTitle>@($"{ApplicationDetail.ApplicationName} | {ProductsPageModel?.Title}")</PageTitle>

@* <ProductSubButtons PageModel="ProductsPageModel" /> *@
<ProductSubMenu />

<MainMenuContainer>
    <RadzenText TextStyle="TextStyle.H5">@ProductsPageModel?.Title</RadzenText>
    <BreadCrumb breadCrumbs="@BreadCrumbs" />
</MainMenuContainer>

<MainMenuContainer>
    <RadzenText TextStyle="TextStyle.Body1">This is your product list. This products will be use in all of transactions related to inventory in the entire application.</RadzenText>
</MainMenuContainer>

<MainMenuContainer>
    <RadzenSplitButton Click=@(args => OnFilterButtonClick(args))
                       Icon="@filterIcon"
                       Text="@filterText"
                       Variant="Variant.Outlined"
                       Size="ButtonSize.Medium">
        <ChildContent>
            <RadzenSplitButtonItem Text="By Category" Value="@nameof(FilterCondition.ByProductCategory)" />
            <RadzenSplitButtonItem Text="By Product Name" Value="@nameof(FilterCondition.ByProductName)" />
        </ChildContent>
    </RadzenSplitButton>

    <MainMenuButton LoadDataClicked="EvReloadData"
                    CreateNewClicked="EvCreateNew" />
</MainMenuContainer>

<RadzenStack Orientation="Orientation.Horizontal"
             AlignItems="AlignItems.Start"
             Wrap="FlexWrap.Wrap"
             Gap="10px">
    @if (ProductState.IsFilterByProductCategoryActive)
    {
        <FilterByProductCategory @bind-ProductCategoryIDValue="ProductState.FilterProductCategoryValue"
                                 @bind-IsFilterByProductCategoryActive="ProductState.IsFilterByProductCategoryActive"
                                 ButtonClearFilterClicked="ButtonClearFilterClicked" />
    }
    @if (ProductState.IsFilterByProductNameActive)
    {
        <FilterByProduct @bind-ProductNameValue="ProductState.FilterProductNameValue"
                         @bind-IsFilterByProductNameActive="ProductState.IsFilterByProductNameActive"
                         ButtonClearFilterClicked="ButtonClearFilterClicked" />
    }
</RadzenStack>

@*                 Count="@ProductState.MetaData.TotalCount"
                AllowPaging="true"
                PageSize="@ProductState.MetaData.PageSize"
                PagerHorizontalAlign="HorizontalAlign.Center" *@

<RadzenDataGrid @ref="ProductGrid"
                IsLoading=@isLoading
                Data="@ProductState.ProductList"
                TItem="ProductDtoForProductQueries"
                SelectionMode="DataGridSelectionMode.Single"
                AllowSorting="true"
                AllowFiltering="false"
                AllowColumnResize="true"
                AllowColumnReorder="false"
                GridLines="DataGridGridLines.Both"
                ColumnWidth="150px"
                class="my-4">
    <Columns>
        <RadzenDataGridColumn Width="50px"
                              Title="#" Filterable="false"
                              Sortable="false"
                              TextAlign="TextAlign.Center">
            <Template Context="data">
                @(ProductState.ProductList.IndexOf(data) + 1)
            </Template>
        </RadzenDataGridColumn>

        <RadzenDataGridColumn Property="ProductID"
                              Visible=false
                              Filterable="false"
                              Title="ID"
                              TextAlign="TextAlign.Center">
        </RadzenDataGridColumn>

        <RadzenDataGridColumn Property="CategoryName"
                              Title="Category" />

        <RadzenDataGridColumn Property="Name"
                              Title="Name"
                              Frozen="true" />

        <RadzenDataGridColumn Property="SKU"
                              Title="SKU" />

        <RadzenDataGridColumn Property="Price"
                              Title="Price"
                              FormatString="{0:c}" />

        <RadzenDataGridColumn Property="Description"
                              Title="Description" />

        <RadzenDataGridColumn Property="ImageUrl"
                              Title="Image"
                              Width="60px">
            <Template Context="Product">
                <RadzenImage Path="@Product.ImageUrl"
                             AlternateText="@Path.GetFileName(Product.ImageUrl)"
                             class="img-thumbnail img-fluid" Style="max-height: 80px;" />
            </Template>
        </RadzenDataGridColumn>

        <RadzenDataGridColumn Context="Action"
                              Title="Action"
                              Filterable="false"
                              Sortable="false"
                              TextAlign="TextAlign.Left"
                              Frozen="true"
                              FrozenPosition="FrozenColumnPosition.Right">

            <Template Context="dto">
                <RadzenButton Icon="edit"
                              ButtonStyle="ButtonStyle.Light"
                              Variant="Variant.Flat"
                              Size="ButtonSize.Medium"
                              MouseEnter="@((args) => CustomTooltipService.ShowBottomTooltip(args, TableAction.Edit.ToString()))"
                              Click="@(args => EvEditRow(dto))"
                              @onclick:stopPropagation="true">
                </RadzenButton>
                <RadzenButton ButtonStyle="ButtonStyle.Danger"
                              Icon="delete"
                              Variant="Variant.Flat"
                              Shade="Shade.Lighter"
                              Size="ButtonSize.Medium"
                              class="my-1 ms-1"
                              MouseEnter="@((args) => CustomTooltipService.ShowBottomTooltip(args, TableAction.Delete.ToString()))"
                              Click="@(async args => await EvDeleteRow(dto))"
                              @onclick:stopPropagation="true">
                </RadzenButton>
            </Template>
        </RadzenDataGridColumn>
    </Columns>
</RadzenDataGrid>

<Pager @ref="Pager"
       PageSize="@ProductState.MetaData.PageSize"
       TotalCount="@ProductState.MetaData.TotalCount"
       CurrentPage="ProductState.ProductParameter.PageNumber"
       PageChanged="@(args => PageChanged(args))" />
